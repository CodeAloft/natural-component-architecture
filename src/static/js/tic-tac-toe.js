class Component{rootElement;eventListeners;constructor(){this.eventListeners=[]}setRootElement(e){this.rootElement=e}inflate(e,t){}deflate(){this.rootElement&&this.rootElement.parentElement&&(this.removeEventListeners(),this.rootElement.parentElement.removeChild(this.rootElement))}addEventListener(e,t,s){this.isElement(e)&&(e.addEventListener(t,s),this.eventListeners.push({el:e,type:t,listener:s}))}removeEventListeners(){let e,t;for(e=0;e<this.eventListeners.length;e++)(t=this.eventListeners[e]).el.removeEventListener(t.type,t.listener)}isElement(e){return e instanceof Element||e instanceof HTMLDocument}}class Square extends Component{game;position;player;playerHistory;constructor(e,t){super(),this.game=e,this.position=t}inflate(e){const t=this;var s;e&&(s=document.createDocumentFragment(),this.rootElement=document.createElement("button"),this.rootElement.className="square",this.addEventListener(this.rootElement,"click",function(){t.activate()}),this.addEventListener(this.closeButton,"keydown",function(){13!==event.keyCode&&32!==event.keyCode||t.activate()}),s.appendChild(this.rootElement),e.appendChild(s))}activate(){this.player||this.game.winner||(this.playerHistory=this.game.nextPlayer,this.refresh(),this.game.onMove(this.position))}clear(){this.rootElement.textContent="",this.player=null}refresh(){this.rootElement.textContent=this.playerHistory,this.player=this.playerHistory}}class Move extends Component{game;position;index;constructor(e,t){super(),this.game=e,this.position=t}inflate(t,s){const n=this;if(t){let e="Go to game start";0<(this.index=s)&&(e="Go to move #"+this.index);var s=document.createDocumentFragment(),i=(this.rootElement=document.createElement("li"),document.createElement("button"));i.appendChild(document.createTextNode(e)),this.rootElement.appendChild(i),this.addEventListener(i,"click",function(){n.revertGame()}),this.addEventListener(this.closeButton,"keydown",function(){13!==event.keyCode&&32!==event.keyCode||n.revertGame()}),s.appendChild(this.rootElement),t.appendChild(s)}}revertGame(){this.game.revert(this.index)}}class Game extends Component{squares;moves;moveIndex;nextPlayer;winner;statusLabel;moveList;constructor(){super(),this.squares=[],this.moves=[],this.moveIndex=-1}inflate(o){if(o){var a=document.createDocumentFragment(),r=(this.rootElement=document.createElement("div"),this.rootElement.className="game",document.createElement("div"));r.className="game-board",this.statusLabel=document.createElement("div"),this.statusLabel.className="status-label",r.appendChild(this.statusLabel);let e,t,s,n,i=0;for(e=0;e<3;e++){for((t=document.createElement("div")).className="board-row",s=0;s<3;s++)(n=new Square(this,i)).inflate(t),this.squares.push(n),i++;r.appendChild(t)}this.rootElement.appendChild(r);var l=document.createElement("div");l.className="game-info",this.moveList=document.createElement("ol"),l.appendChild(this.moveList),this.rootElement.appendChild(l),a.appendChild(this.rootElement),o.appendChild(a),this.onMove(-1)}}onMove(e){this.refreshMoves(),this.moveIndex++;e=new Move(this,e);e.inflate(this.moveList,this.moveIndex),this.moves.push(e),this.updateGameStatus()}revert(e){let t,s,n;for(t=this.moves.length-1;0<t;t--)s=this.moves[t],n=this.squares[s.position],this.nextPlayer=n.player,t>e?n.clear():n.refresh();this.moveIndex=e,this.updateGameStatus(),this.winner=null}refreshMoves(){let e;for(e=this.moves.length-1;e>this.moveIndex;e--)this.moves.pop().deflate()}updateGameStatus(){var e=this.moveIndex%2==0;this.nextPlayer=e?"X":"0",this.winner=this.calculateWinner(),this.winner?this.statusLabel.textContent="Winner: "+this.winner:this.statusLabel.textContent="Next Player: "+this.nextPlayer}calculateWinner(){var t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let e=0;e<t.length;e++){var[s,n,i]=t[e];if(this.squares[s].player&&this.squares[s].player===this.squares[n].player&&this.squares[s].player===this.squares[i].player)return this.squares[s].player}return null}}const gameContainer=document.querySelector("#game-container"),game=new Game;game.inflate(gameContainer);